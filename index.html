<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <!-- åˆ†é ç”¨ -->
<link rel="icon" type="image/png" sizes="32x32" href="icon.png">

<!-- iOS ä¸»ç•«é¢ç”¨ -->
<link rel="apple-touch-icon" sizes="180x180" href="icon.png">

<!-- Android PWA -->
<link rel="manifest" href="manifest.json">
  <meta charset="UTF-8">
  <title>é¸æ“‡å°å¹«æ‰‹</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background-color: #f0f9ff;
      margin: 0;
      padding: 0;
    }
    .nav {
      display: flex;
      justify-content: center;
      background-color: #a8dadc;
      padding: 10px 0;
      flex-wrap: wrap;
    }
    .nav button {
      font-size: 16px;
      padding: 10px 20px;
      margin: 6px;
      border: none;
      background-color: #ffffff;
      border-radius: 5px;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      transition: all 0.2s ease;
    }
    .nav button.active {
      background-color: #ffe066;
      font-weight: bold;
      transform: scale(1.05);
    }
    .page {
      display: none;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    .page.active {
      display: block;
    }
    h1 {
      text-align: center;
      padding: 20px;
      color: #2c3e50;
      margin: 0;
    }
    .btn-primary {
      background-color: #3db8c4;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 20px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: all 0.2s ease;
    }
    .btn-primary:hover {
      background-color: #35a4af;
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
      transform: translateY(-2px);
    }
    .btn-primary:active {
      background-color: #2d8e98;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2) inset;
      transform: translateY(1px);
    }
    .btn-yellow {
      background-color: #fff3b0;
      color: #333;
      border: none;
      border-radius: 8px;
      padding: 10px 14px;
      font-size: 16px;
      margin: 4px;
      cursor: pointer;
    }
    input, select, button {
      padding: 10px;
      font-size: 16px;
      margin: 6px 4px 10px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    input, select {
      width: 100%;
    }
    ul {
      list-style-type: none;
      padding: 0;
    }
    li {
      background: #e9fce6;
      padding: 10px;
      margin-bottom: 8px;
      border-radius: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    li span {
      flex-grow: 1;
      min-width: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .remove-btn {
      background: none;
      border: none;
      color: #c0392b;
      font-size: 18px;
      cursor: pointer;
      margin-left: 10px;
      flex-shrink: 0;
    }
    .random-container {
      text-align: center;
      margin-top: 20px;
    }
    .result-card {
      margin-top: 30px;
      padding: 30px;
      background: linear-gradient(145deg, #fff8dc, #fff6ae);
      border-radius: 20px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
      font-size: 2.2em;
      font-weight: bold;
      color: #b34400;
      opacity: 0;
      transform: scale(0.5);
      transition: all 0.6s ease;
        white-space: nowrap;             /* ä¸æ›è¡Œ */
  overflow: hidden;                /* è¶…å‡ºéš±è— */
  text-overflow: ellipsis;        /* åŠ ä¸Šçœç•¥è™Ÿï¼ˆå¯é¸ï¼‰ */
  font-size: clamp(3em, 2.5vw, 1.2em); /* è‡ªå‹•ç¸®æ”¾æ–‡å­—å¤§å°ï¼Œé¿å…æ›è¡Œ */
    }
    .result-card.show {
      opacity: 1;
      transform: scale(1);
    }
    .result-card.glow {
      animation: multiGlow 1.8s ease-out;
      animation-fill-mode: both;
    }
    @keyframes multiGlow {
      0%   { box-shadow: 0 0 0 transparent; }
      20%  { box-shadow: 0 0 20px #ffd700; }
      40%  { box-shadow: 0 0 25px #ffffff; }
      60%  { box-shadow: 0 0 30px #ff8c00; }
      80%  { box-shadow: 0 0 25px #ffe066; }
      100% { box-shadow: 0 0 20px #ffd700; }
    }
    .current-list-label {
      font-size: 16px;
      margin-bottom: 10px;
      color: #333;
    }
    .current-list-label select {
      font-weight: bold;
      color: #2c3e50;
      background-color: #fff;
      border: 1px solid #aaa;
    }

    .btn-pink {
      background-color: #fcebeb;
      color: #333;
      border: none;
      border-radius: 5px;
      padding: 10px 16px;
      font-size: 14px;
      cursor: pointer;
    }

    .btn-lightblue {
      background-color: #e0f4ff;
      color: #333;
      border: none;
      border-radius: 5px;
      padding: 10px 16px;
      font-size: 14px;
      cursor: pointer;
    }
.slot-machine {
  display: none; /* â† åˆå§‹ä¸é¡¯ç¤º */
  height: 60px;
  overflow: hidden;
  position: relative;
  margin: 30px auto 0;
  width: 80%;
  max-width: 300px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  font-size: 26px;
  font-weight: bold;
  text-align: center;
  color: #b34400;
  border: 3px dashed #ffe066;
  opacity: 0;
  transform: translateY(-20px);
  transition: all 0.6s ease;
}

.slot-machine.show {
  display: block;
  opacity: 1;
  transform: translateY(0);
}

.slot-content {
  display: flex;
  flex-direction: column;
  animation: spinScroll 2s ease-out forwards;
}

@keyframes spinScroll {
  0%   { transform: translateY(0); }
  90%  { transform: translateY(-90%); }
  100% { transform: translateY(-100%); }
}
  </style>
</head>
<body>
<h1><img src="https://cdn.jsdelivr.net/gh/a355226/choosehelper@main/icon.png" alt="icon" width="32">
é¸æ“‡å°å¹«æ‰‹</h1>

<div class="nav">
  <button class="active" onclick="showPage('randomPage')">ğŸ”€ éš¨æ©Ÿé¸æ“‡</button>
  <button onclick="showPage('editPage')">ğŸ“ ç·¨è¼¯æ¸…å–®</button>
</div>

<div class="page active" id="randomPage">
  <div class="current-list-label">
    ç›®å‰æ¸…å–®ï¼š<select id="topMemorySelect" onchange="switchMemoryFromTop()">
      <option value="">-- è«‹é¸æ“‡ --</option>
    </select>
  </div>
  <div class="random-container">
    <button class="btn-primary" style="width:100%; font-size:20px;" onclick="chooseRandom()">éš¨æ©Ÿé¸ğŸ²</button>
    <div id="resultCard" class="result-card">è«‹å…ˆå»ºç«‹æ¸…å–®</div>
<div id="slotMachine" class="slot-machine"></div>
    <div id="appealArea"></div>
  </div>
</div>

<div class="page" id="editPage">
  <div class="section-title">ğŸ“‚ å¿«é€Ÿåˆ‡æ›è¨˜æ†¶æ¸…å–®ï¼š</div>
  <select id="memorySelect" onchange="loadMemoryList()">
    <option value="">-- è«‹é¸æ“‡ --</option>
  </select>
  <button class="btn-pink" onclick="deleteMemoryList()">ğŸ—‘ åˆªé™¤æ¸…å–®</button>

  <div class="section-title">ğŸ–Š è¼¸å…¥é …ç›®ï¼š</div>
  <input type="text" id="foodInput" placeholder="è«‹è¼¸å…¥" />
  <button class="btn-primary" onclick="addFood()">åŠ å…¥</button>
  <button class="btn-lightblue" onclick="saveCurrentList()">å»ºç«‹æ­¤æ¸…å–®</button>
  <button class="btn-pink"  onclick="clearAllItems()">å…¨éƒ¨æ¸…é™¤</button>
  <div class="section-title">ğŸ“ƒ ç›®å‰æ¸…å–®ï¼š</div>
  <ul id="foodList"></ul>
  <div style="margin-top: 70px;">
    <button class="btn-lightblue" onclick="shareList()">åŒ¯å‡º</button>
    <button class="btn-lightblue" onclick="importList()">åŒ¯å…¥</button>
  </div>
</div>

<script>
let currentList = [];
let memoryData = JSON.parse(localStorage.getItem('memoryData')) || {};
let currentListName = "";

function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
  const btn = id === 'randomPage' ? document.querySelectorAll('.nav button')[0] : document.querySelectorAll('.nav button')[1];
  btn.classList.add('active');
}

function saveMemoryData() {
  localStorage.setItem('memoryData', JSON.stringify(memoryData));
}

function addFood() {
  const input = document.getElementById('foodInput');
  const food = input.value.trim();
  if (food) {
    currentList.push(food);
    input.value = '';
    renderCurrentList();
  }
}

function renderCurrentList() {
  const ul = document.getElementById('foodList');
  ul.innerHTML = '';
  currentList.forEach((item, index) => {
    const li = document.createElement('li');
    const span = document.createElement('span');
    span.textContent = item;
    const btn = document.createElement('button');
    btn.textContent = 'âœ•';
    btn.className = 'remove-btn';
    btn.onclick = () => removeItem(index);
    li.appendChild(span);
    li.appendChild(btn);
    ul.appendChild(li);
  });
}
function removeItem(index) {
  currentList.splice(index, 1);
  renderCurrentList();
}

function clearAllItems() {
  if (confirm("ç¢ºå®šè¦æ¸…é™¤ç›®å‰æ‰€æœ‰é …ç›®ï¼Ÿ")) {
    currentList = [];
    renderCurrentList();
  }
}

function saveCurrentList() {
  const name = prompt("è«‹è¼¸å…¥æ­¤æ¸…å–®çš„åç¨±ï¼š");
  if (name && name.trim()) {
    memoryData[name] = [...currentList];
    currentListName = name;
    saveMemoryData();
    updateMemorySelect();
    alert(`å·²è¨˜æ†¶æ¸…å–®ï¼šã€Œ${name}ã€`);
  }
}

function updateMemorySelect() {
  const selects = [document.getElementById('memorySelect'), document.getElementById('topMemorySelect')];
  selects.forEach(select => {
    select.innerHTML = '<option value="">-- è«‹é¸æ“‡ --</option>';
    for (let name in memoryData) {
      const option = document.createElement('option');
      option.value = name;
      option.textContent = name;
      if (name === currentListName) option.selected = true;
      select.appendChild(option);
    }
  });
}

function loadMemoryList() {
  const selected = document.getElementById('memorySelect').value;
  if (!selected) {
    currentList = [];
    currentListName = "";
    renderCurrentList();
    return;
  }

  if (memoryData[selected]) {
    currentList = [...memoryData[selected]];
    currentListName = selected;
    updateMemorySelect();
    renderCurrentList();
  }
}

function switchMemoryFromTop() {
  const selected = document.getElementById('topMemorySelect').value;
  if (!selected) {
    currentList = [];
    currentListName = "";
    renderCurrentList();
    return;
  }
  if (memoryData[selected]) {
    currentList = [...memoryData[selected]];
    currentListName = selected;
    updateMemorySelect();
    renderCurrentList();
  }
}

function deleteMemoryList() {
  const selected = document.getElementById('memorySelect').value;
  if (selected && memoryData[selected]) {
    if (confirm(`ç¢ºå®šè¦åˆªé™¤è¨˜æ†¶æ¸…å–®ï¼šã€Œ${selected}ã€ï¼Ÿ`)) {
      delete memoryData[selected];
      if (currentListName === selected) {
        currentListName = "";
        currentList = [];
        renderCurrentList();
      }
      saveMemoryData();
      updateMemorySelect();
      alert(`ã€Œ${selected}ã€å·²åˆªé™¤`);
    }
  } else {
    alert("è«‹å…ˆé¸æ“‡è¦åˆªé™¤çš„æ¸…å–®");
  }
}

function shareList() {
  const text = JSON.stringify({ name: currentListName, items: currentList });
  if (navigator.share) {
    navigator.share({
      title: 'æˆ‘çš„é¸æ“‡æ¸…å–®',
      text: text
    }).catch(err => alert("åˆ†äº«å¤±æ•—ï¼š" + err));
  } else {
    prompt("è«‹è¤‡è£½ä»¥ä¸‹å…§å®¹ä»¥åˆ†äº«ï¼š", text);
  }
}

function importList() {
  const text = prompt("è«‹è²¼ä¸Šåˆ†äº«å…§å®¹ï¼š");
  if (!text) return;
  try {
    const parsed = JSON.parse(text);
    if (!parsed.name || !Array.isArray(parsed.items)) throw new Error("æ ¼å¼éŒ¯èª¤");
    memoryData[parsed.name] = parsed.items;
    currentListName = parsed.name;
    currentList = [...parsed.items];
    saveMemoryData();
    updateMemorySelect();
    renderCurrentList();
    alert(`æˆåŠŸåŒ¯å…¥æ¸…å–®ï¼šã€Œ${parsed.name}ã€`);
  } catch (e) {
    alert("âŒ åŒ¯å…¥å¤±æ•—ï¼šæ ¼å¼éŒ¯èª¤");
  }
}

// åˆå§‹åŒ–
updateMemorySelect();
renderCurrentList();

let appealCount = 3;

function chooseRandom(isAppeal = false) {
  const resultCard = document.getElementById('resultCard');
  const appealArea = document.getElementById('appealArea');
  const slotMachine = document.getElementById('slotMachine');

  if (!isAppeal) appealCount = 3;
  appealArea.innerHTML = '';
  resultCard.textContent = 'ğŸ° æ­£åœ¨æŠ½ç±¤...';
  resultCard.classList.remove('show', 'glow');

  if (currentList.length === 0) {
    resultCard.textContent = 'è«‹å…ˆè¼¸å…¥é¸é …';
    resultCard.classList.add('show', 'glow');
    return;
  }

  // é¡¯ç¤º slotMachine ä¸¦å•Ÿå‹•æ·¡å…¥å‹•ç•«
  slotMachine.innerHTML = '';
  slotMachine.classList.add('show');

  // æº–å‚™å¤§é‡å‡é¸é … + çœŸæ­£çµæœï¼ˆ90 å€‹ï¼‰
  const finalIndex = Math.floor(Math.random() * currentList.length);
  const spinList = [];
  for (let i = 0; i < 90; i++) {
    spinList.push(currentList[Math.floor(Math.random() * currentList.length)]);
  }
  spinList.push(currentList[finalIndex]);

  // çµ„ slotContent
  const slotContent = document.createElement('div');
  slotContent.className = 'slot-content';
  slotContent.style.animation = 'none';
  slotContent.innerHTML = spinList.map(item => `<div>${item}</div>`).join('');
  slotMachine.appendChild(slotContent);

  // å•Ÿå‹•å‹•ç•«
  void slotContent.offsetWidth;
  slotContent.style.animation = 'spinScroll 3.2s ease-out forwards'; // â± æ™‚é–“å»¶é•·

  // çµæŸå¾Œè™•ç†çµæœèˆ‡ä¸Šè¨´
  setTimeout(() => {
    resultCard.textContent = `ğŸ‰ ${currentList[finalIndex]}`;
    resultCard.classList.add('show', 'glow');

    if (appealCount > 0) {
      const btn = document.createElement('button');
      btn.textContent = `ä¸Šè¨´ï¼ï¼ˆå‰©é¤˜${appealCount}æ¬¡ï¼‰`;
      btn.className = 'btn-pink';
      btn.style.marginTop = '20px';
      btn.style.backgroundColor = ['#ffe6e6', '#ffb3b3', '#ff6666'][3 - appealCount] || '#ff6666';
      btn.style.color = '#800000';
      btn.onclick = () => {
        appealCount--;
        chooseRandom(true);
      };
      appealArea.appendChild(btn);
    } else {
      const finalText = document.createElement('div');
      finalText.textContent = 'èªå‘½å§ï¼Œé€™å°±æ˜¯æœ€å¥½çš„é¸æ“‡ï¼';
      finalText.style.marginTop = '20px';
      finalText.style.fontWeight = 'bold';
      finalText.style.color = '#b34400';
      appealArea.appendChild(finalText);
    }
  }, 3300); // å‹•ç•«å®Œæˆå¾ŒåŸ·è¡Œ
}

  const v = Date.now(); // æ¯æ¬¡åˆ·æ–°éƒ½å¸¶å…¥å”¯ä¸€å€¼ï¼Œé¿é–‹å¿«å–
document.querySelectorAll('link[rel="icon"], link[rel="manifest"]').forEach(el => {
  if (el.href) {
    el.href += (el.href.includes('?') ? '&' : '?') + 'v=' + v;
  }
});
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/service-worker.js?v=' + v)
    .then(reg => console.log('SW è¨»å†ŠæˆåŠŸ', reg.scope))
    .catch(err => console.log('SW è¨»å†Šå¤±æ•—', err));
}

</script>
</body>
</html>
